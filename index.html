<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.socket.io/4.4.1/socket.io.min.js" integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>
  
  <link rel="stylesheet" href="app.css">
  <title>Document</title>
</head>
<body>
  <h1>
    Poor man's yt downloader
  </h1>

<form method="post" action="#">
  <input type="text" name="email" id="mail">
  <input id="sendPost" type="submit" value="Download" class="btn" onclick="buttonPressed()">
  <div class="loader" id="loading"></div>
  <!-- <input type="file" nwsaveas="filename.txt" /> -->
</form>

<button onclick="videoQueue()">
  Search Video
</button>

<p id="infoText"></p>



<script>

  let videosArr = [];
  let text = document.getElementById("mail").value;

  const socket = io();
  // client-side
  socket.on("connect", () => {
    console.log(socket.id); // x8WIv7-mJelg7on_ALbx
  });

  // Receive the the message from the server
  socket.on("sendText", (arg) => {
    console.log("sendText" , arg);
    document.getElementById("infoText").innerHTML = arg;
    document.getElementById("sendPost").style.visibility = 'visible';
  })


  // On button VIDEO QUEUE (no submit is made)
  function videoQueue() {
    if (document.getElementById("mail").value != "") {
      videosArr.push(document.getElementById("mail").value);
      console.log(videosArr);
    }
    socket.emit("videoQue", document.getElementById("mail").value);
  }

  // on button SUBMIT FORM
  function buttonPressed() {
    document.getElementById("sendPost").style.visibility = 'hidden';
    document.getElementById("loading").style.visibility = 'visible';
    socket.emit("downloadPressed", document.getElementById("mail").value, (response) => {
      console.log("it got response");
      document.getElementById("infoText").innerHTML = response.text;
    });
    //document.getElementById("sendPost").disabled = true;
  }

</script>


</body>
</html>